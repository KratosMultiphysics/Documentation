<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KratosMultiphysics: Adjoint Sensitivity Analysis</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../kratos_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KratosMultiphysics
   </div>
   <div id="projectbrief">KRATOS Multiphysics (Kratos) is a framework for building parallel, multi-disciplinary simulation software, aiming at modularity, extensibility, and high performance. Kratos is written in C++, and counts with an extensive Python interface.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Adjoint Sensitivity Analysis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>General remarks:</h2>
<p>This feature provides the framework to compute sensitivities of structural responses (e.g. displacements, strain energy or stresses) with respect to different types of design variables (e.g. nodal coordinates, material or cross-sectional properties or load intensity) with the adjoint approach. An adjoint system has to be solved for each responsefunciton. The sensitivities are then computed in a post-processing step.</p>
<p><em>Please note:</em></p><ul>
<li>This feature currently only works for linear problems (exception: geometric nonlinear problems exclusively modeled with TrussElement3D2N)</li>
<li>This feature makes use of the <a class="el" href="../../df/df5/namespace_h_d_f5_application.html" title="Core HDF5 IO.">HDF5Application</a></li>
</ul>
<h2>Features:</h2>
<p>Provided is a <b>scheme</b> to solve the adjoint problem and a <b>replacement process</b> which replaces all elements and conditions of a model with its adjoint equivalents and vice versa.</p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Response Function   </th><th class="markdownTableHeadNone">Semi-analytic   </th><th class="markdownTableHeadNone">Analytic   </th><th class="markdownTableHeadNone">Static   </th><th class="markdownTableHeadNone">Transient    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Linear strain energy   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Displacement or rotation of a node   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stress resultant of a single element   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p><em>In the table above, the first two columns (Semi-analytic, Analytic) refer to the way, the partial derivative of the response is calculated.</em></p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Structural Condition   </th><th class="markdownTableHeadNone">Adjoint Condition   </th><th class="markdownTableHeadNone">Design Variables   </th><th class="markdownTableHeadNone">Semi-analytic   </th><th class="markdownTableHeadNone">Analytic   </th><th class="markdownTableHeadNone">Static   </th><th class="markdownTableHeadNone">Transient    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PointLoadCondition   </td><td class="markdownTableBodyNone">PointLoadAdjointCondition¹   </td><td class="markdownTableBodyNone">POINT_LOAD   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">SHAPE_SENSITIVITY   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Structural Element   </th><th class="markdownTableHeadNone">Adjoint Element   </th><th class="markdownTableHeadNone">Design Variables   </th><th class="markdownTableHeadNone">Semi-analytic   </th><th class="markdownTableHeadNone">Analytic   </th><th class="markdownTableHeadNone">Static   </th><th class="markdownTableHeadNone">Transient    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ShellThinElement3D3N   </td><td class="markdownTableBodyNone">AdjointFiniteDifferencingShellElement¹   </td><td class="markdownTableBodyNone">THICKNESS²   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>| | | SHAPE_SENSITIVITY | x | | x | | CrBeamElementLinear3D2N | AdjointFiniteDifferenceCrBeamElement¹ | I22²| x | | x | | | | | SHAPE_SENSITIVITY | x | | x | | | TrussElement3D2N | AdjointFiniteDifferenceTrussElement¹ | CROSS_AREA²| x | x³ | x | | | | | SHAPE_SENSITIVITY | x | | x | | | TrussLinearElement3D2N | AdjointFiniteDifferenceTrussLinearElement¹ | CROSS_AREA²| x | | x | | | | | SHAPE_SENSITIVITY | x | | x | |</p>
<p>¹ The adjoint elements and conditions wrap elements/conditions of the Structural Mechanics Application and can call its public functions. The main task of the adjoint elements/conditions is to derive different quantities (e.g. the right hand side or post-processing results like stresses) with respect to the design variable or state.</p>
<p>² In principle the adjoint elements are able to compute sensitivities w.r.t. to all properties which are available at a specific element. <code>THICKNESS</code> and <code>I22</code> are possible examples. One only has to ensure that a corresponding Kratos-Variable for the sensitivity result is defined (e.g. for the design variable <code>THICKNESS</code> a corresponding variable called <code>THICKNESS_SENSITIVITY</code> is necessary). This additional variable is necessary to store the results of the sensitivity analysis. See also the paragraph Post-Processing.</p>
<p>³ the nonlinear adjoint truss element is able to compute its stress-displacement-derivative analytically. All other derivatives are computed by finite-difference approximation on element level.</p>
<h2>Usage:</h2>
<p>In order to perform a sensitivity analysis for one response function, the solution of two problems is necessary: The primal and the adjoint problem.</p>
<p><em>Please note:</em> For the solution of the two problems different kind of variables are used in order to store the results. For the primal problem the usual variables <code>DISPLACEMENT</code> and <code>ROTATION</code> and for the adjoint problem <code>ADJOINT_DISPLACEMENT</code> and <code>ADJOINT_ROTATION</code> are used.</p>
<h3>Definition of the Primal Problem</h3>
<p>The primal problem can be defined by the regular input files which are needed for standard analysis. As only difference the output process of the <a class="el" href="../../df/df5/namespace_h_d_f5_application.html" title="Core HDF5 IO.">HDF5Application</a> has to be added in the project parameters. An example for a possible file is: <em>StructuralMechanicsApplication/tests/adjoint_sensitivity_analysis_tests/adjoint_beam_structure_3d2n/beam_test_parameters.json</em></p>
<h3>Definition of the Adjoint Problem</h3>
<p>In order to define the adjoint problem an additional *.json-file for the adjoint project parameters is necessary. This input file is in principle very similar to the respective file of the primal analysis. In comparison to a regular file for a linear static analysis three points have to be modified:</p><ul>
<li><code>solver_settings</code> by using the <code>adjoint</code> as <code>solver_type</code> and by the definition of the <code>response_function_settings</code></li>
<li>The input process of the <a class="el" href="../../df/df5/namespace_h_d_f5_application.html" title="Core HDF5 IO.">HDF5Application</a> has to be added in order to read the primal solution</li>
<li>When defining <em>Dirichlet</em> conditions <code>ADJOINT_DISPLACEMENT</code> respective <code>ADJOINT_ROTATION</code> instead of <code>DISPLACEMENT</code> respective <code>ROTATION</code> have to be used.</li>
</ul>
<p>An example for a possible input file is: <em>StructuralMechanicsApplication/tests/adjoint_sensitivity_analysis_tests/adjoint_beam_structure_3d2n/beam_test_local_stress_adjoint_parameters.json</em></p>
<h3>How to run the analysis:</h3>
<p>If all necessary input files are defined, the analysis can be performed with a simple python script by calling the primal and afterwards the adjoint analysis. The sensitivities are computed in a post-processing of the adjoint problem.</p>
<p>A possible python workflow can be found in: <em>StructuralMechanicsApplication/tests/test_adjoint_sensitivity_analysis_beam_3d2n_structure.py</em></p>
<h3>Possible <code>response_function_settings</code>:</h3>
<p>Independent from the chosen response function the following definitions are always necessary:</p>
<ul>
<li><code>gradient_mode</code>: Currently there is only <code>semi_analytic</code> available.</li>
<li><code>step_size</code> is the perturbation measure for finite difference computations within the semi-analytic approach.</li>
<li><code>sensitivity_model_part_name</code>: The name of the model part for which components sensitivities have to be computed (e.g. if the chosen design parameter is <code>THICKNESS</code> then for each element in this model part the sensitivity w.r.t. this variable is calculated).</li>
<li><code>nodal_solution_step_sensitivity_variables</code>: Currently only <code>SHAPE_SENSITIVITY</code> is available. Doing this the sensitivities w.r.t. to the x-, y- and z-coordinate of all nodes in the <code>sensitivity_model_part_name</code> are computed.</li>
<li><code>element_data_value_sensitivity_variables</code>: Here sensitivities with respect to the properties of the elements are computed. For that the respective name of the Kratos-Variable has to be given (e.g. <code>THICKNESS</code>, <code>I22</code> or <code>YOUNG_MODULUS</code>)</li>
<li><code>condition_sensitivity_variables</code>: Here sensitivities with respect to the properties of the conditions are computed. Currently there is only <code>POINT_LOAD</code> available.</li>
</ul>
<p><b>Important, please note:</b> In order to use an element or condition design variable one has to ensure that a corresponding Kratos-Variable for the sensitivity is defined (e.g. for the design variable <code>THICKNESS</code> a corresponding variable called <code>THICKNESS_SENSITIVITY</code> is necessary). This additional variable is necessary to store the results of the sensitivity analysis.</p>
<p>There are currently three different types of response functions available which can be chosen as <code>response_type</code>. For each of them specific settings are necessary:</p><ul>
<li><code>adjoint_nodal_displacement</code>: The response is the displacement or rotation of a single node. Necessary additional settings are:<ul>
<li><code>traced_node_id</code>: ID of the traced node</li>
<li><code>traced_dof</code>: Define the traced DOF (e.g. <code>DISPLACEMENT_Z</code> or <code>ROTATION_X</code>)</li>
</ul>
</li>
<li><code>adjoint_linear_strain_energy</code>: The response is the linear strain energy. No additional settings are necessary.</li>
<li><code>adjoint_local_stress</code>: The response is the stress or stress-resultant of a single element. Necessary additional settings are:<ul>
<li><code>traced_element_id</code>: ID of the element which should be traced</li>
<li><code>stress_type</code>: Stress type which should be traced (e.g. FX, MY, FXX or MXX)</li>
<li><code>stress_treatment</code>: There are three possibilities:<ul>
<li><code>node</code> (Takes the response value at the position of a defined node of the element. Only available for beam element.),</li>
<li><code>GP</code> (Takes the response value at a defined Gauss-Point of the element.)</li>
<li><code>mean</code> (The response is the mean value of all Gauss-Point results of the traced stress type.)</li>
</ul>
</li>
<li><code>stress_location</code>: Only necessary if <code>node</code> or <code>GP</code> is chosen as <code>stress_treatment</code>. Local index of the gauss point or node where the stress should be traced respectively. E.g. if the stress resultant of a beam element should be traced at the first of the two nodes <code>stress_location</code> has to be 1)</li>
</ul>
</li>
</ul>
<p>Exemplary input files:</p><ul>
<li>StructuralMechanicsApplication/tests/adjoint_sensitivity_analysis_tests/adjoint_beam_structure_3d2n/beam_test_local_stress_adjoint_parameters.json</li>
<li>StructuralMechanicsApplication/tests/adjoint_sensitivity_analysis_tests/adjoint_beam_structure_3d2n/beam_test_nodal_disp_adjoint_parameters.json</li>
<li>StructuralMechanicsApplication/tests/adjoint_sensitivity_analysis_tests/adjoint_beam_structure_3d2n/beam_test_strain_energy_adjoint_parameters.json</li>
</ul>
<h2>Post-Processing</h2>
<p>The results of the sensitivity analysis are accessible in the post-processing as <code>nodal_results</code> (currently only <code>SHAPE_SENSITIVITY</code> and <code>POINT_LOAD_SENSITIVITY</code>) and <code>gauss_point_results</code> (sensitivities for elemental design variables like <code>THICKNESS_SENSITIVITY</code> or <code>I22_SENSITIVITY</code>). </p><div class="fragment"><div class="line">&quot;nodal_results&quot;       : [&quot;ADJOINT_DISPLACEMENT&quot;, &quot;SHAPE_SENSITIVITY&quot;, &quot;POINT_LOAD_SENSITIVITY&quot;],</div>
<div class="line">&quot;gauss_point_results&quot; : [&quot;THICKNESS_SENSITIVITY&quot;]</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 13 2024 02:54:14 for KratosMultiphysics by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
